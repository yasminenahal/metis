```
      ___           ___                                   ___     
     /__/\         /  /\          ___       ___          /  /\    
    |  |::\       /  /:/_        /  /\     /  /\        /  /:/_   
    |  |:|:\     /  /:/ /\      /  /:/    /  /:/       /  /:/ /\  
  __|__|:|\:\   /  /:/ /:/_    /  /:/    /__/::\      /  /:/ /::\ 
 /__/::::| \:\ /__/:/ /:/ /\  /  /::\    \__\/\:\__  /__/:/ /:/\:\
 \  \:\~~\__\/ \  \:\/:/ /:/ /__/:/\:\      \  \:\/\ \  \:\/:/~/:/
  \  \:\        \  \::/ /:/  \__\/  \:\      \__\::/  \  \::/ /:/ 
   \  \:\        \  \:\/:/        \  \:\     /__/:/    \__\/ /:/  
    \  \:\        \  \::/          \__\/     \__\/       /__/:/   
     \__\/         \__\/                                 \__\/
```   
This is the repository for "Metis" a GUI to aid in the human analysis of de novo generated molecules.
At its core it is build around [Esben Bjerrums](https://github.com/EBjerrum) [rdEditor](https://github.com/EBjerrum/rdeditor).

## Set up

### Packages
RDKit, PySide2, pandas, scikit-learn>1.0.0

### SSH
It is assumed you have a working version of Reinvent 3 on a Server instance that is running SLURM and SSH.

1. Change the ssh settings in the `metis/to_reinvent/input_files/ssh_settings.yml` file [here](https://github.com/yasminenahal/metis/blob/nahal_experiment/metis/reinvent_connect/input_files/ssh_settings.yml).
      - `ssh_login`: your loging to SSH e.g. `username@remote_server` *you should be able to access your remote server without password for example using an RSA Key*
      - `path_remote_folder`: path on the remote machine, from where Reinvent files will be loaded and stored.
2. Copy an inital Reinvent Agent into the same directory specified under `path_remote_folder` in the `ssh_settings.yml` file
      - This agent is the inital state of Reinvent from which we are starting to evaluate with help of the human
      - the agent file **must** be called `Agent_Initial.ckpt`
      - 
###  Settings
In the `metis/setting.yml` file, properties regarding the settings of the GUI can be changed

- `tutorial (bool)`: If `true`will start a tutorial before opening. 

- `introText (str)`: Define text that should read at top of the screen shown for every molecule

- What information should be eb displayed to the user for each molecule.
`"Label": "column name in dataframe"`
```
propertyLabels: 
  "DRD2 Activity": "raw_DRD2"
  "Herg Activity": "raw_herg"
```
#### data
- `initial_path` (str): path to inital dataset, the molecules that shall be evaluated first
- `path` (str):   path to subsequent datasets, these come from the server, and are generated by Reinvent
- `selection_strategy`(str): how to pick which molecules to show
- `num_molecules` (int): 20 how many molecules to show
- `run_name` (str): what is the name of the run, under this name the results will be stored 

#### ui
- `render (bool`: if true renders particular button
- `slider (bool)`: if true, uses slider rather than multiple choice to evaluategneral goodness of molecule

Liablities control which properties you can select substructures for:
Keys such as `ugly` or `tox` are simply used within the script.
`name` will define how the button is called 
`color` will define the color of the button as well as the color of the atom highligght
```
liabilities:
      ugly:
        name: "Mutagenicity"
        color: "#ff7f7f"
      tox:
        name: "Toxicity" 
        color: "#51d67e"
      stability:
        name: "Stability"
        color: "#eed358"
      like:
        name: "Good"
        color: "#9542f5"
```
Global properties will define for which gloabl proerties users can give feedback
In `liablities`a list of all Liabilities has to be provided.
```
  global_properties:
    render: true
    liabilities: 
            "Solubility",
            "Lipophilicity",
            "Plasma Proteinbinding",
            "Synthetic Accessibility",
            "Permeability",
            "hERG",
        ]
```

#### interactive model

Here information relevant for iterativly training the QSAR models are specified
- `oracle_path (str)`: path to oracle model
- `model_path (str)`: path to QSAR model which should be updated
- `training_data_path (str)`: path to trainings data
- `ECFP (dict)`: properties of the ECFP as input for the model
  

## Usage

Simply run  
```
python metis.py
```
This will start the GUI. 

## Blog
Esben wrote a blog post with an overview of the structure of the code.
[https://www.wildcardconsulting.dk/rdeditor-an-open-source-molecular-editor-based-using-python-pyside2-and-rdkit/](https://www.wildcardconsulting.dk/rdeditor-an-open-source-molecular-editor-based-using-python-pyside2-and-rdkit/)



